var v=Object.defineProperty;var b=(r,t,e)=>t in r?v(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var o=(r,t,e)=>(b(r,typeof t!="symbol"?t+"":t,e),e);import{E as g,e as y,f as w,C as V,B as A,M as E,a as B,b as x,g as m,Q as d,h as f}from"./Uniforms.1c993ea0.js";class F extends g{constructor(){super(),this.isAnimating=!1,this.animatingCount=0,this.dispatchEvents=[],this.variables={},this.dataBase={}}add(t){let e={time:-1,value:this.getValueClone(t.initValue),startValue:this.getValueClone(t.initValue),goalValue:this.getValueClone(t.initValue),easing:t.easing||y.sigmoid(),lerpFunc:t.customLerpFunc||w.getLerpFunc(t.initValue),userData:t.userData};return this.dataBase[t.name]=e.value,this.variables[t.name]=e,this.dispatchEvent({type:"added",varName:t.name,variable:e}),e}setEasing(t,e){let i=this.variables[t];i?i.easing=e:console.warn('"'+t+'" is not exist')}setValue(t,e){let i=this.dataBase[t];if(i!==void 0)typeof i=="number"?this.dataBase[t]=e:"copy"in i?i.copy(e):i instanceof Array&&(i=e.concat()),this.updateDataBase(t),this.cancelAnimate(t);else return console.warn('"'+t+'" is not exist'),null}animate(t,e,i=1,a,n){let s=this.variables[t];return new Promise(h=>{if(s){if(i<=0){this.setValue(t,e),s.time=1,s.onAnimationFinished=()=>{a&&a(),h(null)};return}s.time==-1&&(this.isAnimating=!0,this.animatingCount++),s.time=0,s.duration=i,s.startValue=this.getValueClone(s.value),s.goalValue=this.getValueClone(e),s.onAnimationFinished=()=>{a&&a(),h(null)},n&&this.setEasing(t,n)}else console.warn('"'+t+'" is not exist')})}cancelAnimate(t){let e=this.variables[t];e?(e.time=1,e.onAnimationFinished=null):console.warn('"'+t+'" is not exist')}get(t){return this.variables[t]?this.variables[t].value:(console.warn('"'+t+'" is not exist'),null)}getVariableObject(t,e=!1){return this.variables[t]?this.variables[t]:(e||console.warn('"'+t+'" is not exist'),null)}applyToUniforms(t){let e=Object.keys(this.variables);for(let i=0;i<e.length;i++){let a=this.getVariableObject(e[i]);a&&(t[e[i]]=a)}}isAnimatingVariable(t,e=!1){return this.variables[t]?this.variables[t].time!=-1:(e||console.warn('"'+t+'" is not exist'),null)}getValueClone(t){return typeof t=="number"?t:"clone"in t?t.clone():t instanceof Array?t.concat():t}wait(t){return new Promise(i=>{setTimeout(()=>{i()},t*1e3)})}update(t){this.animatingCount==0&&(this.isAnimating=!1);let e=Object.keys(this.variables);for(let i=0;i<e.length;i++){let a=e[i],n=this.variables[a],s=n.time;if(s==1&&(this.animatingCount--,s=-1,n.onAnimationFinished&&this.dispatchEvents.push(n.onAnimationFinished)),s>=0&&s<1){let l=n.duration,h=n.easing,p=n.lerpFunc;l&&(s+=(t||.016)/l,(l==0||s>=1)&&(s=1));let c=n.goalValue;s<1&&p&&(c=p(n.startValue,n.goalValue,h(s)));let u=this.dataBase[a];typeof u=="number"||!("copy"in u)?this.dataBase[a]=c:"copy"in u&&u.copy(c),this.dispatchEvent({type:"update/"+e[i],deltaTime:t,value:n.value})}n.time=s}for(;this.dispatchEvents.length!=0;){let i=this.dispatchEvents.pop();i&&i()}this.updateDataBase(),this.dispatchEvent({type:"update",deltaTime:t}),this.isAnimating&&this.dispatchEvent({type:"animate",deltaTime:t})}updateDataBase(t){if(t){let i=this.variables[t],a=this.dataBase[t];i&&a!==void 0&&(typeof i.value=="number"||!("copy"in i.value))&&(i.value=a);return}let e=Object.keys(this.dataBase);for(let i=0;i<e.length;i++){let a=this.variables[e[i]],n=this.dataBase[e[i]];a&&n!==void 0&&(typeof a.value=="number"||!("copy"in a.value))&&(a.value=n)}}}class C extends A{constructor(){super();o(this,"animator");o(this,"box");o(this,"cnt",0)}onBind(e){super.onBind(e),this.camera.position.set(0,1.5,4),this.camera.lookAt(0,0,0),this.box=new E(new B,new x),this.scene.add(this.box),this.initAnimator()}initAnimator(){this.animator=new F,this.animator.add({name:"pos",initValue:new m(0,0,0)}),this.animator.add({name:"rot",initValue:new d().setFromEuler(new f(0,0,0))}),this.startPosAnimation(),this.startRotAnimation(),this.animator.addEventListener("update/rot",e=>{this.animator&&console.log("update/rot",e.value)})}startPosAnimation(){this.animator!=null&&this.animator.animate("pos",new m(1,0,0),1,()=>{this.animator!=null&&this.animator.animate("pos",new m(-1,0,0),1,()=>{this.startPosAnimation()})})}startRotAnimation(){this.animator!=null&&this.animator.animate("rot",new d().setFromEuler(new f(0,0,-Math.PI)),1,()=>{this.animator!=null&&this.animator.animate("rot",new d().setFromEuler(new f(0,0,0)),1,()=>{this.startRotAnimation()})})}animate(e){if(this.animator){this.animator.update(e);const i=this.animator.get("pos"),a=this.animator.get("rot");this.box&&i&&a&&(this.box.position.copy(i),this.box.quaternion.copy(a))}this.renderer&&this.renderer.render(this.scene,this.camera)}}class P{constructor(){o(this,"controller");o(this,"scene");this.controller=new V,this.scene=new C,this.controller.addLayer(this.scene,{name:"Main",canvas:document.querySelector("#canvas")})}}window.addEventListener("load",()=>{new P});
