(function(d,T){typeof exports=="object"&&typeof module<"u"?T(exports,require("three"),require("wolfy87-eventemitter")):typeof define=="function"&&define.amd?define(["exports","three","wolfy87-eventemitter"],T):(d=typeof globalThis<"u"?globalThis:d||self,T(d.ORE={},d.THREE,d.EventEmitter))})(this,function(d,T,V){"use strict";const B=o=>o&&typeof o=="object"&&"default"in o?o:{default:o};function P(o){if(o&&o.__esModule)return o;const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(o){for(const t in o)if(t!=="default"){const i=Object.getOwnPropertyDescriptor(o,t);Object.defineProperty(e,t,i.get?i:{enumerable:!0,get:()=>o[t]})}}return e.default=o,Object.freeze(e)}const h=P(T),x=B(V);class _ extends h.EventDispatcher{constructor(e){super(),this.time=0,this.readyAnimate=!1,this.renderer=new h.WebGLRenderer(e),this.renderer.setPixelRatio(e.pixelRatio||window.devicePixelRatio),this.renderer.debug.checkShaderErrors=!0,this.info={canvas:this.renderer.domElement,aspectSetting:{mainAspect:16/9,wideAspect:10/1,portraitAspect:1/2},size:{windowSize:new h.Vector2,windowAspectRatio:1,canvasSize:new h.Vector2,canvasPixelSize:new h.Vector2,canvasAspectRatio:1,pixelRatio:this.renderer.getPixelRatio(),portraitWeight:0,wideWeight:0},...e},e.wrapperElement&&this.setWrapperElement(e.wrapperElement||null,!1),this.commonUniforms={time:{value:0}},this.scene=new h.Scene,this.camera=new h.PerspectiveCamera(50,1,.1,1e3)}tick(e){this.time+=e,this.commonUniforms.time.value=this.time,this.readyAnimate&&this.animate(e)}animate(e){}onBind(){setTimeout(()=>{this.onResize(),this.readyAnimate=!0},0)}onUnbind(){this.dispatchEvent({type:"dispose"}),this.removeChildrens(this.scene),this.readyAnimate=!1}removeChildrens(e){const t=e.children.length;for(let i=t-1;i>=0;i--){this.removeChildrens(e.children[i]);let n,s;e.children[i].isMesh&&(n=e.children[i].geometry,s=e.children[i].material),e.remove(e.children[i]),n&&n.dispose(),s&&s.dispose()}}setWrapperElement(e,t=!0){this.info.wrapperElement=e,this.info.wrapperElementRect=e?e.getBoundingClientRect():null,t&&this.onResize()}onResize(){if(this.renderer==null)return;const e=new h.Vector2(document.body.clientWidth,window.innerHeight),t=new h.Vector2;this.info.wrapperElement?t.set(this.info.wrapperElement.clientWidth,this.info.wrapperElement.clientHeight):t.copy(e);let i=1-(t.x/t.y-this.info.aspectSetting.portraitAspect)/(this.info.aspectSetting.mainAspect-this.info.aspectSetting.portraitAspect);i=Math.min(1,Math.max(0,i));let n=1-(t.x/t.y-this.info.aspectSetting.wideAspect)/(this.info.aspectSetting.mainAspect-this.info.aspectSetting.wideAspect);n=Math.min(1,Math.max(0,n)),this.info.size.windowSize.copy(e),this.info.size.windowAspectRatio=e.x/e.y,this.info.size.canvasSize.copy(t),this.info.size.canvasPixelSize.copy(t.clone().multiplyScalar(this.renderer.getPixelRatio())),this.info.size.canvasAspectRatio=t.x/t.y,this.info.size.portraitWeight=i,this.info.size.wideWeight=n,this.renderer.setPixelRatio(this.info.size.pixelRatio),this.renderer.setSize(this.info.size.canvasSize.x,this.info.size.canvasSize.y),this.camera.aspect=this.info.size.canvasAspectRatio,this.camera.updateProjectionMatrix(),this.info.wrapperElement&&(this.info.wrapperElementRect=this.info.wrapperElement.getBoundingClientRect())}pointerEvent(e){const t=new h.Vector2;if(t.copy(e.position),this.info.canvas){const s=this.info.canvas.getBoundingClientRect();t.sub(new h.Vector2(s.x,s.y))}const i=t.clone();i.divide(this.info.size.canvasSize),i.y=1-i.y,i.multiplyScalar(2).subScalar(1);const n={event:e.pointerEvent,position:t.clone(),delta:e.delta.clone(),screenPosition:i.clone(),windowPosition:e.position.clone()};e.pointerEventType=="hover"?this.onHover(n):e.pointerEventType=="start"?this.onTouchStart(n):e.pointerEventType=="move"?this.onTouchMove(n):e.pointerEventType=="end"&&this.onTouchEnd(n)}onTouchStart(e){}onTouchMove(e){}onTouchEnd(e){}onHover(e){}onWheel(e,t){}}class I extends h.EventDispatcher{constructor(){super(),this.element=null,this.trackpadMemDelta=0,this.trackpadMax=!1,this.position=new h.Vector2(NaN,NaN),this.delta=new h.Vector2(NaN,NaN);const e=navigator.userAgent;this.isSP=e.indexOf("iPhone")>=0||e.indexOf("iPad")>=0||e.indexOf("Android")>=0||navigator.platform=="iPad"||navigator.platform=="MacIntel"&&navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1&&navigator.standalone!==void 0,this.position.set(NaN,NaN),this.isTouching=!1}registerElement(e){this.element=e;const t=this.onTouch.bind(this,"start"),i=this.onTouch.bind(this,"move"),n=this.onTouch.bind(this,"end"),s=this.onPointer.bind(this,"start"),c=this.onPointer.bind(this,"move"),l=this.onPointer.bind(this,"end"),f=this.wheel.bind(this);e.addEventListener("touchstart",t,{passive:!1}),e.addEventListener("touchmove",i,{passive:!1}),e.addEventListener("touchend",n,{passive:!1}),e.addEventListener("pointerdown",s),e.addEventListener("pointermove",c),e.addEventListener("pointerup",l),e.addEventListener("dragend",l),e.addEventListener("wheel",f,{passive:!1});const a=u=>{e.isEqualNode(u.elm)&&(e.removeEventListener("touchstart",t),e.removeEventListener("touchmove",i),e.removeEventListener("touchend",n),e.removeEventListener("pointerdown",s),e.removeEventListener("pointermove",c),e.removeEventListener("pointerup",l),e.removeEventListener("dragend",l),e.removeEventListener("wheel",f),this.removeEventListener("unregister",a))};this.addEventListener("unregister",a)}unregisterElement(e){this.dispatchEvent({type:"unregister",elm:e})}getScreenPosition(e){if(this.position.x!=this.position.x)return new h.Vector2(NaN,NaN);const t=this.position.clone().divide(e).multiplyScalar(2).subScalar(1);return t.y*=-1,t}getRelativePosition(e,t){const i=e.getClientRects()[0];let n=this.position.x-i.left,s=this.position.y-i.top;return t&&(n/=i.width,s/=i.height),new h.Vector2(n,s)}setPos(e,t){this.position.x!==this.position.x||this.position.y!==this.position.y?this.delta.set(0,0):this.delta.set(e-this.position.x,t-this.position.y),this.position.set(e,t)}onTouch(e,t){const i=t.touches[0];i?this.touchEventHandler(i.pageX,i.pageY,e,t):e=="end"&&this.touchEventHandler(NaN,NaN,e,t)}onPointer(e,t){const i=t.pointerType;i!=null?i=="mouse"&&(t.button==-1||t.button==0)&&this.touchEventHandler(t.pageX,t.pageY,e,t):this.touchEventHandler(t.pageX,t.pageY,e,t)}touchEventHandler(e,t,i,n){let s=!1;const c=e-window.pageXOffset,l=t-window.pageYOffset;i=="start"?(this.isTouching=!0,this.setPos(c,l),this.delta.set(0,0),s=!0):i=="move"?(this.setPos(c,l),this.isTouching&&(s=!0)):i=="end"&&("targetTouches"in n?n.targetTouches.length==0&&(this.isTouching=!1):this.isTouching=!1,s=!0),s&&this.dispatchEvent({type:"update",pointerEvent:n,pointerEventType:i,position:this.position.clone(),delta:this.delta.clone()})}update(){this.isSP||this.dispatchEvent({type:"update",pointerEvent:null,pointerEventType:"hover",position:this.position.clone(),delta:this.delta.clone()})}wheel(e){this.dispatchEvent({type:"wheel",wheelEvent:e})}}class k extends h.EventDispatcher{constructor(e){super(),this.layers=[],e&&e.silent||console.log("%c- ore-three -","padding: 5px 10px ;background-color: black; color: white;font-size:11px"),this.clock=new h.Clock,this.pointer=new I,this.setPointerEventElement(e&&e.pointerEventElement||document.body);const t=this.pointerEvent.bind(this),i=this.onWheel.bind(this),n=this.onOrientationDevice.bind(this),s=this.onWindowResize.bind(this);this.pointer.addEventListener("update",t),this.pointer.addEventListener("wheel",i),window.addEventListener("orientationchange",n),window.addEventListener("resize",s),this.addEventListener("dispose",()=>{this.pointer.removeEventListener("update",t),this.pointer.removeEventListener("wheel",i),window.removeEventListener("orientationchange",n),window.removeEventListener("resize",s)}),this.tick()}tick(){const e=this.clock.getDelta();this.pointer.update();for(let t=0;t<this.layers.length;t++)this.layers[t].tick(e);requestAnimationFrame(this.tick.bind(this))}onWindowResize(){for(let e=0;e<this.layers.length;e++)this.layers[e].onResize()}onOrientationDevice(){this.onWindowResize()}pointerEvent(e){for(let t=0;t<this.layers.length;t++)this.layers[t].pointerEvent(e)}onWheel(e){for(let t=0;t<this.layers.length;t++)this.layers[t].onWheel(e.wheelEvent,e.trackpadDelta)}addLayer(e){this.layers.push(e),e.onBind()}getLayer(e){for(let t=0;t<this.layers.length;t++)if(this.layers[t].info.name==e)return this.layers[t];return null}removeLayer(e){for(let t=this.layers.length-1;t>=0;t--){const i=this.layers[t];i.info.name==e&&(i.onUnbind(),this.layers.splice(t,1))}}setPointerEventElement(e){this.pointerEventElement&&this.pointer.unregisterElement(this.pointerEventElement),this.pointer.registerElement(e),this.pointerEventElement=e}dispose(){this.layers.map(t=>t.info.name).forEach(t=>{this.removeLayer(t)}),this.tick=()=>{},this.dispatchEvent({type:"dispose"})}}var S;(o=>{o.NEWTON_ITERATIONS=4,o.NEWTON_MIN_SLOPE=.001,o.SUBDIVISION_PRECISION=1e-7,o.SUBDIVISION_MAX_ITERATIONS=10,o.BEZIER_EASING_CACHE_SIZE=11,o.BEZIER_EASING_SAMPLE_STEP_SIZE=1/o.BEZIER_EASING_CACHE_SIZE;function e(a){return-a.p0+3*a.p1-3*a.p2+a.p3}function t(a){return 3*a.p0-6*a.p1+3*a.p2}function i(a){return-3*a.p0+3*a.p1}function n(a,u){return 3*e(a)*u*u+2*t(a)*u+i(a)}o.calcBezierSlope=n;function s(a,u){return((e(a)*u+t(a))*u+i(a))*u+a.p0}o.calcBezier=s;function c(a,u,m,E){let v=0,g=0;for(let w=0;w<o.SUBDIVISION_MAX_ITERATIONS;w++)g=u+(m-u)/2,v=s(E,g),v>a?m=g:u=g;return g}function l(a,u,m){for(let E=0;E<o.NEWTON_ITERATIONS;E++){const v=n(u,m);if(v==0)return m;m-=(s(u,m)-a)/v}return m}function f(a,u,m){a.p1=Math.max(a.p0,Math.min(a.p3,a.p1)),a.p2=Math.max(a.p0,Math.min(a.p3,a.p2));let E=0;for(let w=1;w<m.length&&(E=w-1,!(u<m[w]));w++);const v=E/(o.BEZIER_EASING_CACHE_SIZE-1),g=n(a,v)/(a.p3-a.p0);return g==0?v:g>.01?l(u,a,v):c(u,v,v+o.BEZIER_EASING_SAMPLE_STEP_SIZE,a)}o.getBezierTfromX=f})(S||(S={})),d.Easings=void 0,(o=>{function e(r=6){return b=>{var y=Math.exp(-r*(2*b-1)),p=Math.exp(-r);return(1+(1-y)/(1+y)*(1+p)/(1-p))/2}}o.sigmoid=e;function t(r,b,y){const p=Math.max(0,Math.min(1,(y-r)/(b-r)));return p*p*(3-2*p)}o.smoothstep=t;function i(r){return r}o.linear=i;function n(r){return r*r}o.easeInQuad=n;function s(r){return r*(2-r)}o.easeOutQuad=s;function c(r){return r<.5?2*r*r:-1+(4-2*r)*r}o.easeInOutQuad=c;function l(r){return r*r*r}o.easeInCubic=l;function f(r){return--r*r*r+1}o.easeOutCubic=f;function a(r){return r<.5?4*r*r*r:(r-1)*(2*r-2)*(2*r-2)+1}o.easeInOutCubic=a;function u(r){return r*r*r*r}o.easeInQuart=u;function m(r){return 1- --r*r*r*r}o.easeOutQuart=m;function E(r){return r<.5?8*r*r*r*r:1-8*--r*r*r*r}o.easeInOutQuart=E;function v(r){return r*r*r*r*r}o.easeInQuint=v;function g(r){return 1+--r*r*r*r*r}o.easeOutQuint=g;function w(r){return r<.5?16*r*r*r*r*r:1+16*--r*r*r*r*r}o.easeInOutQuint=w;function O(r,b,y,p){for(var N=new Array(S.BEZIER_EASING_CACHE_SIZE),A=0;A<S.BEZIER_EASING_CACHE_SIZE;++A)N[A]=S.calcBezier({p0:r.x,p1:b.x,p2:y.x,p3:p.x},A/(S.BEZIER_EASING_CACHE_SIZE-1));return C=>C<=r.x?r.y:p.x<=C?p.y:S.calcBezier({p0:r.y,p1:b.y,p2:y.y,p3:p.y},S.getBezierTfromX({p0:r.x,p1:b.x,p2:y.x,p3:p.x},C,N))}o.bezier=O;function K(r,b,y,p){return O({x:0,y:0},{x:r,y:b},{x:y,y:p},{x:1,y:1})}o.cubicBezier=K})(d.Easings||(d.Easings={})),d.Lerps=void 0,(o=>{function e(l,f,a){return l+(f-l)*a}o.number=e;function t(l,f,a){if(l.length==f.length){const u=[];for(let m=0;m<l.length;m++)u.push(l[m]+(f[m]-l[m])*a);return u}else return console.log("Different length Arrays!!!"),!1}o.numberArray=t;function i(l,f,a){return l.clone().lerp(f,a)}o.THREEVectors=i;function n(l,f,a){return l.clone().slerp(f,a)}o.THREEQuaternion=n;function s(l,f,a){const u=l.clone(),m=f.clone();return u.x=u.x+(m.x-u.x)*a,u.y=u.y+(m.y-u.y)*a,u.z=u.z+(m.z-u.z)*a,u}o.THREEEuler=s;function c(l){if(typeof l=="number")return o.number;if(l instanceof Array)return o.numberArray;if("isVector2"in l||"isVector3"in l||"isVector4"in l||"isColor"in l)return o.THREEVectors;if("isQuaternion"in l)return o.THREEQuaternion;if("isEuler"in l)return o.THREEEuler}o.getLerpFunc=c})(d.Lerps||(d.Lerps={}));class M extends h.EventDispatcher{constructor(){super(),this.isAnimating=!1,this.animatingCount=0,this.dispatchEvents=[],this.variables={},this.dataBase={}}add(e){const t={time:-1,value:this.getValueClone(e.initValue),startValue:this.getValueClone(e.initValue),goalValue:this.getValueClone(e.initValue),easing:e.easing||d.Easings.sigmoid(),lerpFunc:e.customLerpFunc||d.Lerps.getLerpFunc(e.initValue),userData:e.userData};return this.dataBase[e.name]=t.value,this.variables[e.name]=t,this.dispatchEvent({type:"added",varName:e.name,variable:t}),t}setEasing(e,t){const i=this.variables[e];i?i.easing=t:console.warn('"'+e+'" is not exist')}setValue(e,t){let i=this.dataBase[e];if(i!==void 0)typeof i=="number"?this.dataBase[e]=t:"copy"in i?i.copy(t):i instanceof Array&&(i=t.concat()),this.updateDataBase(e),this.cancelAnimate(e);else return console.warn('"'+e+'" is not exist'),null}animate(e,t,i=1,n,s){const c=this.variables[e];return new Promise(f=>{if(c){if(i<=0){this.setValue(e,t),c.time=1,c.onAnimationFinished=()=>{n&&n(),f(null)};return}c.time==-1&&(this.isAnimating=!0,this.animatingCount++),c.time=0,c.duration=i,c.startValue=this.getValueClone(c.value),c.goalValue=this.getValueClone(t),c.onAnimationFinished=()=>{n&&n(),f(null)},s&&this.setEasing(e,s)}else console.warn('"'+e+'" is not exist')})}cancelAnimate(e){const t=this.variables[e];t?(t.time=1,t.onAnimationFinished=null):console.warn('"'+e+'" is not exist')}get(e){return this.variables[e]?this.variables[e].value:(console.warn('"'+e+'" is not exist'),null)}getVariableObject(e,t=!1){return this.variables[e]?this.variables[e]:(t||console.warn('"'+e+'" is not exist'),null)}applyToUniforms(e){const t=Object.keys(this.variables);for(let i=0;i<t.length;i++){const n=this.getVariableObject(t[i]);n&&(e[t[i]]=n)}}isAnimatingVariable(e,t=!1){return this.variables[e]?this.variables[e].time!=-1:(t||console.warn('"'+e+'" is not exist'),null)}getValueClone(e){return typeof e=="number"?e:"clone"in e?e.clone():e instanceof Array?e.concat():e}wait(e){return new Promise(i=>{setTimeout(()=>{i()},e*1e3)})}update(e){this.animatingCount==0&&(this.isAnimating=!1);const t=Object.keys(this.variables);for(let i=0;i<t.length;i++){const n=t[i],s=this.variables[n];let c=s.time;if(c==1&&(this.animatingCount--,c=-1,s.onAnimationFinished&&this.dispatchEvents.push(s.onAnimationFinished)),c>=0&&c<1){const l=s.duration,f=s.easing,a=s.lerpFunc;l&&(c+=(e||.016)/l,(l==0||c>=1)&&(c=1));let u=s.goalValue;c<1&&a&&(u=a(s.startValue,s.goalValue,f(c)));const m=this.dataBase[n];typeof m=="number"||!("copy"in m)?this.dataBase[n]=u:"copy"in m&&m.copy(u),this.dispatchEvent({type:"update/"+t[i],deltaTime:e,value:s.value})}s.time=c}for(;this.dispatchEvents.length!=0;){const i=this.dispatchEvents.pop();i&&i()}this.updateDataBase(),this.dispatchEvent({type:"update",deltaTime:e}),this.isAnimating&&this.dispatchEvent({type:"animate",deltaTime:e})}updateDataBase(e){if(e){const i=this.variables[e],n=this.dataBase[e];i&&n!==void 0&&(typeof i.value=="number"||!("copy"in i.value))&&(i.value=n);return}const t=Object.keys(this.dataBase);for(let i=0;i<t.length;i++){const n=this.variables[t[i]],s=this.dataBase[t[i]];n&&s!==void 0&&(typeof n.value=="number"||!("copy"in n.value))&&(n.value=s)}}}class F extends x.default{constructor(e){super(),this.curves={},this.name=e||"",this.uniforms={},this.frame={start:0,end:0,duration:0}}addFcurveGroup(e,t){this.curves[e]=t,this.calcFrame()}removeFCurve(e){delete this.curves[e],this.calcFrame()}calcFrame(){let e=Object.keys(this.curves),t=1/0,i=-1/0;for(let n=0;n<e.length;n++){let s=this.curves[e[n]];s.frameStart<t&&(t=s.frameStart),s.frameEnd>i&&(i=s.frameEnd)}(t==-1/0||i==1/0)&&(t=0,i=1),this.frame.start=t,this.frame.end=i,this.frame.duration=this.frame.end-this.frame.start}getFCurveGroup(e){return this.curves[e]||null}assignUniforms(e,t){this.uniforms[e]=t}getUniforms(e){if(this.uniforms[e])return this.uniforms[e];let t=this.getFCurveGroup(e);if(t){let i={value:t.createInitValue()};return this.uniforms[e]=i,i}return null}getValue(e,t){let i=this.getUniforms(e);if(!i)return t||null;let n=i.value;return t?typeof n=="number"?(t.x=n,t):(t.x=n.x,t.y=n.y,"z"in t&&"z"in n&&(t.z=n.z),"w"in t&&"w"in n&&(t.w=n.w),t||null):n}getValueAt(e,t,i){let n=this.getFCurveGroup(e);return i?n?n.getValue(t||0,i):i:n?n.getValue(t):null}updateFrame(e){let t=Object.keys(this.curves);for(let i=0;i<t.length;i++){let n=this.curves[t[i]],s=this.getUniforms(t[i]);!s||(typeof s.value=="number"?s.value=n.getValue(e)||0:n.getValue(e,s.value))}this.emitEvent("update",[this])}}class R extends x.default{constructor(e){super(),this.keyframes=[],this.cache={frame:NaN,value:NaN},this.frameStart=0,this.frameEnd=0,this.frameDuration=0,this.set(e)}set(e){e&&(this.keyframes.length=0,e.forEach(t=>{this.addKeyFrame(t)}))}addKeyFrame(e){let t=0;for(let i=0;i<this.keyframes.length&&this.keyframes[i].coordinate.x<e.coordinate.x;i++)t++;this.keyframes.splice(t,0,e),this.frameStart=this.keyframes[0].coordinate.x,this.frameEnd=this.keyframes[this.keyframes.length-1].coordinate.x}getValue(e){if(e==this.cache.frame)return this.cache.value;let t=null;for(let i=0;i<this.keyframes.length;i++){let n=this.keyframes[i];if(e<=n.coordinate.x){let s=this.keyframes[i-1];s?t=s.to(n,e):t=n.coordinate.y;break}}return t===null&&this.keyframes.length>0&&(t=this.keyframes[this.keyframes.length-1].coordinate.y),t!==null?(this.cache={frame:e,value:t},t):0}}class L extends x.default{constructor(e,t,i,n,s,c){super(),this.type="scalar",this.name=e||"",this.frameStart=0,this.frameEnd=0,this.frameDuration=0,this.curve={x:null,y:null,z:null,w:null,scalar:null},t&&this.setFCurve(t,"x"),i&&this.setFCurve(i,"y"),n&&this.setFCurve(n,"z"),s&&this.setFCurve(s,"w")}setFCurve(e,t){this.curve[t]=e,this.calcType(),this.calcFrame()}calcType(){this.curve.scalar&&(this.type="scalar"),this.curve.w?this.type="vec4":this.curve.z?this.type="vec3":this.curve.y?this.type="vec2":this.curve.x&&(this.type="scalar")}calcFrame(){let e=Object.keys(this.curve),t=1/0,i=-1/0;for(let n=0;n<e.length;n++){let s=this.curve[e[n]];!s||(s.frameStart<t&&(t=s.frameStart),s.frameEnd>i&&(i=s.frameEnd))}(t==-1/0||i==1/0)&&(t=0,i=1),this.frameStart=t,this.frameEnd=i,this.frameDuration=this.frameEnd-this.frameStart}createInitValue(){return this.type=="vec2"?new h.Vector2:this.type=="vec3"?new h.Vector3:this.type=="vec4"?new h.Vector4:0}getValue(e,t){return t?(this.curve.x&&(t.x=this.curve.x.getValue(e)),this.curve.y&&(t.y=this.curve.y.getValue(e)),this.curve.z&&"z"in t&&(t.z=this.curve.z.getValue(e)),this.curve.w&&"w"in t&&(t.w=this.curve.w.getValue(e)),t):this.curve.scalar?this.curve.scalar.getValue(e):null}}class z extends x.default{constructor(e,t,i,n){super(),this.coordinate={x:0,y:0},this.handleLeft={x:0,y:0},this.handleRight={x:0,y:0},this.interpolation="BEZIER",this.easing=null,this.nextFrame=null,this.set(e,t,i,n)}set(e,t,i,n){this.coordinate=e,this.handleLeft=t||e,this.handleRight=i||e,this.interpolation=n||"BEZIER"}getEasing(e,t){return e=="BEZIER"?d.Easings.bezier(this.coordinate,this.handleRight,t.handleLeft,t.coordinate):i=>{let n=t.coordinate.y-this.coordinate.y;return i=(i-this.coordinate.x)/(t.coordinate.x-this.coordinate.x),this.coordinate.y+i*n}}to(e,t){return(this.nextFrame==null||this.nextFrame.coordinate.x!=e.coordinate.x||this.nextFrame.coordinate.y!=e.coordinate.y)&&(this.easing=this.getEasing(this.interpolation,e),this.nextFrame=e),this.easing?this.easing(t):0}}class D extends x.default{constructor(e){super(),this.connected=!1,this.frameCurrent=0,this.frameStart=0,this.frameEnd=0,this.objects=[],this.actions=[],e&&(this.url=e,this.connect(this.url))}connect(e){this.url=e,this.ws=new WebSocket(this.url),this.ws.onopen=this.onOpen.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onclose=this.onClose.bind(this),this.ws.onerror=t=>{console.error(t)}}syncJsonScene(e){let t=new XMLHttpRequest;t.onreadystatechange=()=>{t.readyState==4&&t.status==200&&this.onSyncScene(JSON.parse(t.response))},t.open("GET",e),t.send()}onSyncScene(e){this.actions.length=0,this.objects.length=0,e.actions.forEach(t=>{let i=new F(t.name),n=Object.keys(t.fcurve_groups);for(let s=0;s<n.length;s++){let c=n[s],l=new L(c);t.fcurve_groups[c].forEach(f=>{let a=new R;a.set(f.keyframes.map(u=>new z(u.c,u.h_l,u.h_r,u.i))),l.setFCurve(a,f.axis)}),i.addFcurveGroup(l.name,l)}this.actions.push(i)}),e.objects.forEach(t=>{this.objects.push(t)}),this.emitEvent("update/scene",[this]),this.setTimeline(this.frameCurrent)}onSyncTimeline(e){this.setTimeline(e.current,e.start,e.end)}onOpen(e){this.connected=!0}onMessage(e){let t=JSON.parse(e.data);t.type=="sync/scene"?this.onSyncScene(t.data):t.type=="sync/timeline"&&this.onSyncTimeline(t.data)}onClose(e){this.disposeWS()}getActionNameList(e){for(let t=0;t<this.objects.length;t++)if(this.objects[t].name==e)return this.objects[t].actions;return[]}getAction(e){for(let t=0;t<this.actions.length;t++)if(this.actions[t].name==e)return this.actions[t];return null}getActionList(e){let t=[];return this.getActionNameList(e).forEach(n=>{let s=this.getAction(n);s&&t.push(s)}),t}getActionContainsAccessor(e){return this.actions.find(t=>Object.keys(t.curves).some(n=>n==e))||null}setTimeline(e,t,i){this.frameCurrent=e,this.frameStart=t||this.frameStart,this.frameEnd=i||this.frameEnd,this.emitEvent("update/timeline",[this.frameCurrent,this.frameStart,this.frameEnd])}dispose(){this.disposeWS()}disposeWS(){this.ws&&(this.ws.close(),this.ws.onmessage=null,this.ws.onclose=null,this.ws.onopen=null,this.connected=!1)}}const G=`#define GLSLIFY 1
varying vec2 vUv;void main(){gl_Position=vec4(position,1.0);vUv=uv;}`,W=`#define GLSLIFY 1
uniform sampler2D tex;varying vec2 vUv;void main(){gl_FragColor=texture2D(tex,vUv);}`;d.UniformsLib=void 0,(o=>{function e(...t){const i={};for(let n=0;n<t.length;n++)t[n]!=null&&Object.assign(i,t[n]);return i}o.mergeUniforms=e})(d.UniformsLib||(d.UniformsLib={}));class U{constructor(e,t){this.renderTargets=[],this.renderer=e,this.dataSize=t.clone(),this.uniforms={dataSize:{value:this.dataSize}},this.tempDataLinear=this.createData({minFilter:h.LinearFilter,magFilter:h.LinearFilter}),this.tempDataNear=this.createData({minFilter:h.NearestFilter,magFilter:h.NearestFilter}),this.scene=new h.Scene,this.camera=new h.Camera,this.materials=[],this.mesh=new h.Mesh(new h.PlaneBufferGeometry(2,2)),this.scene.add(this.mesh)}get isSupported(){return this.renderer.extensions.get("OES_texture_float")}createInitializeTexture(){let e=new Float32Array(this.uniforms.dataSize.value.x*this.uniforms.dataSize.value.y*4),t=new h.DataTexture(e,this.uniforms.dataSize.value.x,this.uniforms.dataSize.value.y,h.RGBAFormat,h.FloatType);return t.needsUpdate=!0,t}createData(e,t){let i=navigator.userAgent,n=i.indexOf("iPhone")>=0||i.indexOf("iPad")>=0||navigator.platform=="iPad"||navigator.platform=="MacIntel"&&navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1&&navigator.standalone!==void 0,s={wrapS:h.ClampToEdgeWrapping,wrapT:h.ClampToEdgeWrapping,minFilter:h.NearestFilter,magFilter:h.NearestFilter,format:h.RGBAFormat,type:n?h.HalfFloatType:h.FloatType,stencilBuffer:!1,depthBuffer:!1},c=null,l=null;e&&(e.isDataTexture?(c=e,t&&(l=t)):l=e),l&&(s.wrapS=l.wrapS||s.wrapS,s.wrapT=l.wrapT||s.wrapT,s.minFilter=l.minFilter||s.minFilter,s.magFilter=l.magFilter||s.magFilter,s.format=l.format||s.format,s.type=l.type||s.type,s.stencilBuffer=l.stencilBuffer||s.stencilBuffer,s.depthBuffer=l.depthBuffer||s.depthBuffer);let f=new h.WebGLRenderTarget(this.uniforms.dataSize.value.x,this.uniforms.dataSize.value.y,s),a={buffer:f};if(this.renderTargets.push(f),c){let u=this.createKernel({fragmentShader:W,uniforms:{tex:{value:c}}});this.compute(u,a)}return a}createKernel(e){let t=d.UniformsLib.mergeUniforms(e.uniforms,this.uniforms);e.uniforms=t,e.vertexShader=e.vertexShader||G;let i=new h.ShaderMaterial(e);return this.materials.push(i),{material:i,uniforms:e.uniforms}}compute(e,t,i){let n;t.buffer.texture.magFilter==h.LinearFilter?n=this.tempDataLinear:n=this.tempDataNear,this.mesh.material=e.material;let s=this.renderer.getRenderTarget();this.renderer.setRenderTarget(n.buffer),this.renderer.render(this.scene,i||this.camera),this.swapBuffers(t,n),this.renderer.setRenderTarget(s)}swapBuffers(e,t){let i=e.buffer;e.buffer=t.buffer,t.buffer=i}dispose(){this.mesh.geometry.dispose();for(let t=0;t<this.materials.length;t++)this.materials[t].dispose();this.scene.remove(this.mesh),this.tempDataLinear.buffer.dispose(),this.tempDataNear.buffer.dispose()}resizeData(e){this.dataSize.copy(e);for(let t=0;t<this.renderTargets.length;t++)this.renderTargets[t].setSize(e.x,e.y)}}const j=`#define GLSLIFY 1
varying vec2 vUv;void main(){vUv=uv;gl_Position=vec4(position,1.0);}`;class H{constructor(e,t,i){this.renderer=e,this.scene=new h.Scene,this.camera=new h.OrthographicCamera(-1,1,1,-1),this.screen=new h.Mesh(i||new h.PlaneBufferGeometry(2,2)),this.scene.add(this.screen),t.vertexShader=t.vertexShader||j,t.uniforms=t.uniforms||{},t.uniforms.resolution={value:new h.Vector2},this.effect={material:new h.ShaderMaterial(t)}}render(e,t=null){let i=this.renderer.getRenderTarget(),n=this.effect,s=n.material,c=s.uniforms;if(e){let l=Object.keys(e);for(let f=0;f<l.length;f++)c[l[f]]?c[l[f]].value=e[l[f]]:(c[l[f]]={value:e[l[f]]},n.material.needsUpdate=!0,n.material.uniforms=c)}t?c.resolution.value.set(t.width,t.height):this.renderer.getSize(c.resolution.value),this.screen.material=s,this.renderer.setRenderTarget(t),this.renderer.render(this.scene,this.camera),this.renderer.setRenderTarget(i)}}class Q{constructor(e,t,i){this.obj=e,this.baseTransform={position:this.obj.position.clone(),rotation:this.obj.quaternion.clone(),scale:this.obj.scale.clone()},this.transform=t,i||(this.transform.position&&this.transform.position.add(this.obj.position),this.transform.rotation&&this.transform.rotation.multiply(this.obj.quaternion))}updateTransform(e){this.transform.position&&this.obj.position.copy(this.baseTransform.position.clone().lerp(this.transform.position,e)),this.transform.rotation&&this.obj.quaternion.copy(this.baseTransform.rotation.clone().slerp(this.transform.rotation,e)),this.transform.scale&&this.obj.scale.copy(this.baseTransform.scale.clone().multiplyScalar(this.transform.scale*e+1-e))}}class Z extends h.EventDispatcher{constructor(){super()}goHome(){this.dispatchEvent({type:"gohome"})}wait(e){return new Promise((t,i)=>{const n=()=>{i(),this.removeEventListener("gohome",n)};this.addEventListener("gohome",n),setTimeout(()=>{this.removeEventListener("gohome",n),t()},e*1e3)})}}d.AnimationAction=F,d.Animator=M,d.BaseLayer=_,d.BlenderConnector=D,d.Controller=k,d.FCurve=R,d.FCurveGroup=L,d.FCurveKeyFrame=z,d.GPUComputationController=U,d.LayoutController=Q,d.Pointer=I,d.PostProcessing=H,d.WaitMan=Z,Object.defineProperties(d,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=ore-three.umd.cjs.map
