(function(m,L){typeof exports=="object"&&typeof module<"u"?L(exports,require("three")):typeof define=="function"&&define.amd?define(["exports","three"],L):(m=typeof globalThis<"u"?globalThis:m||self,L(m.ORE={},m.THREE))})(this,function(m,L){"use strict";function _(l){if(l&&l.__esModule)return l;const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(l){for(const t in l)if(t!=="default"){const i=Object.getOwnPropertyDescriptor(l,t);Object.defineProperty(e,t,i.get?i:{enumerable:!0,get:()=>l[t]})}}return e.default=l,Object.freeze(e)}const d=_(L);class P extends d.EventDispatcher{constructor(){super(),this.readyAnimate=!1,this.time=0,this.info={name:"",aspectSetting:{mainAspect:16/9,wideAspect:10/1,portraitAspect:1/2},size:{windowSize:new d.Vector2,windowAspectRatio:1,canvasSize:new d.Vector2,canvasPixelSize:new d.Vector2,canvasAspectRatio:1,pixelRatio:window.devicePixelRatio,portraitWeight:0,wideWeight:0}},this.commonUniforms={time:{value:0}},this.scene=new d.Scene,this.camera=new d.PerspectiveCamera(50,1,.1,1e3)}tick(e){this.time+=e,this.commonUniforms.time.value=this.time,this.readyAnimate&&this.animate(e)}animate(e){}onBind(e){this.info.name=e.name,this.info.canvas=e.canvas,e.wrapperElement&&this.setWrapperElement(e.wrapperElement||null,!1),this.info.aspectSetting=e.aspectSetting||this.info.aspectSetting,this.info.alpha=e.alpha,this.info.size.pixelRatio=e.pixelRatio||this.info.size.pixelRatio,this.renderer=new d.WebGLRenderer(this.info),this.renderer.setPixelRatio(this.info.size.pixelRatio),this.renderer.debug.checkShaderErrors=!0,this.info.canvas=this.renderer.domElement,setTimeout(()=>{this.onResize(),this.readyAnimate=!0},0)}onUnbind(){this.dispatchEvent({type:"dispose"}),this.removeChildrens(this.scene),this.readyAnimate=!1}removeChildrens(e){const t=e.children.length;for(let i=t-1;i>=0;i--){this.removeChildrens(e.children[i]);let n,r;e.children[i].isMesh&&(n=e.children[i].geometry,r=e.children[i].material),e.remove(e.children[i]),n&&n.dispose(),r&&r.dispose()}}setWrapperElement(e,t=!0){this.info.wrapperElement=e,this.info.wrapperElementRect=e?e.getBoundingClientRect():null,t&&this.onResize()}onResize(){if(this.renderer==null)return;const e=new d.Vector2(document.body.clientWidth,window.innerHeight),t=new d.Vector2;this.info.wrapperElement?t.set(this.info.wrapperElement.clientWidth,this.info.wrapperElement.clientHeight):t.copy(e);let i=1-(t.x/t.y-this.info.aspectSetting.portraitAspect)/(this.info.aspectSetting.mainAspect-this.info.aspectSetting.portraitAspect);i=Math.min(1,Math.max(0,i));let n=1-(t.x/t.y-this.info.aspectSetting.wideAspect)/(this.info.aspectSetting.mainAspect-this.info.aspectSetting.wideAspect);n=Math.min(1,Math.max(0,n)),this.info.size.windowSize.copy(e),this.info.size.windowAspectRatio=e.x/e.y,this.info.size.canvasSize.copy(t),this.info.size.canvasPixelSize.copy(t.clone().multiplyScalar(this.renderer.getPixelRatio())),this.info.size.canvasAspectRatio=t.x/t.y,this.info.size.portraitWeight=i,this.info.size.wideWeight=n,this.renderer.setPixelRatio(this.info.size.pixelRatio),this.renderer.setSize(this.info.size.canvasSize.x,this.info.size.canvasSize.y),this.camera.aspect=this.info.size.canvasAspectRatio,this.camera.updateProjectionMatrix(),this.info.wrapperElement&&(this.info.wrapperElementRect=this.info.wrapperElement.getBoundingClientRect())}pointerEvent(e){const t=new d.Vector2;if(t.copy(e.position),this.info.canvas){const r=this.info.canvas.getBoundingClientRect();t.sub(new d.Vector2(r.x,r.y))}const i=t.clone();i.divide(this.info.size.canvasSize),i.y=1-i.y,i.multiplyScalar(2).subScalar(1);const n={event:e.pointerEvent,position:t.clone(),delta:e.delta.clone(),screenPosition:i.clone(),windowPosition:e.position.clone()};e.pointerEventType=="hover"?this.onHover(n):e.pointerEventType=="start"?this.onTouchStart(n):e.pointerEventType=="move"?this.onTouchMove(n):e.pointerEventType=="end"&&this.onTouchEnd(n)}onTouchStart(e){}onTouchMove(e){}onTouchEnd(e){}onHover(e){}onWheel(e,t){}}class C extends d.EventDispatcher{constructor(){super(),this.trackpadMemDelta=0,this.trackpadMax=!1,this.position=new d.Vector2(NaN,NaN),this.delta=new d.Vector2(NaN,NaN);const e=navigator.userAgent;this.isSP=e.indexOf("iPhone")>=0||e.indexOf("iPad")>=0||e.indexOf("Android")>=0||navigator.platform=="iPad"||navigator.platform=="MacIntel"&&navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1&&navigator.standalone!==void 0,this.position.set(NaN,NaN),this.isTouching=!1}registerElement(e){const t=this.onTouch.bind(this,"start"),i=this.onTouch.bind(this,"move"),n=this.onTouch.bind(this,"end"),r=this.onPointer.bind(this,"start"),f=this.onPointer.bind(this,"move"),h=this.onPointer.bind(this,"end"),u=this.wheel.bind(this);e.addEventListener("touchstart",t,{passive:!1}),e.addEventListener("touchmove",i,{passive:!1}),e.addEventListener("touchend",n,{passive:!1}),e.addEventListener("pointerdown",r),e.addEventListener("pointermove",f),e.addEventListener("pointerup",h),e.addEventListener("dragend",h),e.addEventListener("wheel",u,{passive:!1});const s=a=>{e.isEqualNode(a.elm)&&(e.removeEventListener("touchstart",t),e.removeEventListener("touchmove",i),e.removeEventListener("touchend",n),e.removeEventListener("pointerdown",r),e.removeEventListener("pointermove",f),e.removeEventListener("pointerup",h),e.removeEventListener("dragend",h),e.removeEventListener("wheel",u),this.removeEventListener("unregister",s))};this.addEventListener("unregister",s)}unregisterElement(e){this.dispatchEvent({type:"unregister",elm:e})}getScreenPosition(e){if(this.position.x!=this.position.x)return new d.Vector2(NaN,NaN);const t=this.position.clone().divide(e).multiplyScalar(2).subScalar(1);return t.y*=-1,t}getRelativePosition(e,t){const i=e.getClientRects()[0];let n=this.position.x-i.left,r=this.position.y-i.top;return t&&(n/=i.width,r/=i.height),new d.Vector2(n,r)}setPos(e,t){this.position.x!==this.position.x||this.position.y!==this.position.y?this.delta.set(0,0):this.delta.set(e-this.position.x,t-this.position.y),this.position.set(e,t)}onTouch(e,t){const i=t.touches[0];i?this.touchEventHandler(i.pageX,i.pageY,e,t):e=="end"&&this.touchEventHandler(NaN,NaN,e,t)}onPointer(e,t){const i=t.pointerType;i!=null?i=="mouse"&&(t.button==-1||t.button==0)&&this.touchEventHandler(t.pageX,t.pageY,e,t):this.touchEventHandler(t.pageX,t.pageY,e,t)}touchEventHandler(e,t,i,n){let r=!1;const f=e-window.pageXOffset,h=t-window.pageYOffset;i=="start"?(this.isTouching=!0,this.setPos(f,h),this.delta.set(0,0),r=!0):i=="move"?(this.setPos(f,h),this.isTouching&&(r=!0)):i=="end"&&("targetTouches"in n?n.targetTouches.length==0&&(this.isTouching=!1):this.isTouching=!1,r=!0),r&&this.dispatchEvent({type:"update",pointerEvent:n,pointerEventType:i,position:this.position.clone(),delta:this.delta.clone()})}update(){this.isSP||this.dispatchEvent({type:"update",pointerEvent:null,pointerEventType:"hover",position:this.position.clone(),delta:this.delta.clone()})}wheel(e){this.dispatchEvent({type:"wheel",wheelEvent:e})}}class k extends d.EventDispatcher{constructor(e){super(),this.layers=[],e&&e.silent||console.log("%c- ore-three -","padding: 5px 10px ;background-color: black; color: white;font-size:11px"),this.clock=new d.Clock,this.pointer=new C,this.setPointerEventElement(e&&e.pointerEventElement||document.body);const t=this.pointerEvent.bind(this),i=this.onWheel.bind(this),n=this.onOrientationDevice.bind(this),r=this.onWindowResize.bind(this);this.pointer.addEventListener("update",t),this.pointer.addEventListener("wheel",i),window.addEventListener("orientationchange",n),window.addEventListener("resize",r),this.addEventListener("dispose",()=>{this.pointer.removeEventListener("update",t),this.pointer.removeEventListener("wheel",i),window.removeEventListener("orientationchange",n),window.removeEventListener("resize",r)}),this.tick()}tick(){const e=this.clock.getDelta();this.pointer.update();for(let t=0;t<this.layers.length;t++)this.layers[t].tick(e);requestAnimationFrame(this.tick.bind(this))}onWindowResize(){for(let e=0;e<this.layers.length;e++)this.layers[e].onResize()}onOrientationDevice(){this.onWindowResize()}pointerEvent(e){for(let t=0;t<this.layers.length;t++)this.layers[t].pointerEvent(e)}onWheel(e){for(let t=0;t<this.layers.length;t++)this.layers[t].onWheel(e.wheelEvent,e.trackpadDelta)}addLayer(e,t){for(;this.getLayer(t.name);)t.name+="_";this.layers.push(e),e.onBind(t)}getLayer(e){for(let t=0;t<this.layers.length;t++)if(this.layers[t].info.name==e)return this.layers[t];return null}removeLayer(e){for(let t=this.layers.length-1;t>=0;t--){const i=this.layers[t];i.info.name==e&&(i.onUnbind(),this.layers.splice(t,1))}}setPointerEventElement(e){this.pointerEventElement&&this.pointer.unregisterElement(this.pointerEventElement),this.pointer.registerElement(e),this.pointerEventElement=e}dispose(){this.layers.forEach(e=>{this.removeLayer(e.info.name)}),this.tick=()=>{},this.dispatchEvent({type:"dispose"})}}var S;(l=>{l.NEWTON_ITERATIONS=4,l.NEWTON_MIN_SLOPE=.001,l.SUBDIVISION_PRECISION=1e-7,l.SUBDIVISION_MAX_ITERATIONS=10,l.BEZIER_EASING_CACHE_SIZE=11,l.BEZIER_EASING_SAMPLE_STEP_SIZE=1/l.BEZIER_EASING_CACHE_SIZE;function e(s){return-s.p0+3*s.p1-3*s.p2+s.p3}function t(s){return 3*s.p0-6*s.p1+3*s.p2}function i(s){return-3*s.p0+3*s.p1}function n(s,a){return 3*e(s)*a*a+2*t(s)*a+i(s)}l.calcBezierSlope=n;function r(s,a){return((e(s)*a+t(s))*a+i(s))*a+s.p0}l.calcBezier=r;function f(s,a,c,p){let v=0,g=0;for(let y=0;y<l.SUBDIVISION_MAX_ITERATIONS;y++)g=a+(c-a)/2,v=r(p,g),v>s?c=g:a=g;return g}function h(s,a,c){for(let p=0;p<l.NEWTON_ITERATIONS;p++){let v=n(a,c);if(v==0)return c;c-=(r(a,c)-s)/v}return c}function u(s,a,c){s.p1=Math.max(s.p0,Math.min(s.p3,s.p1)),s.p2=Math.max(s.p0,Math.min(s.p3,s.p2));let p=0;for(let y=1;y<c.length&&(p=y-1,!(a<c[y]));y++);let v=p/(l.BEZIER_EASING_CACHE_SIZE-1),g=n(s,v)/(s.p3-s.p0);return g==0?v:g>.01?h(a,s,v):f(a,v,v+l.BEZIER_EASING_SAMPLE_STEP_SIZE,s)}l.getBezierTfromX=u})(S||(S={})),m.Easings=void 0,(l=>{function e(o=6){return b=>{var w=Math.exp(-o*(2*b-1)),E=Math.exp(-o);return(1+(1-w)/(1+w)*(1+E)/(1-E))/2}}l.sigmoid=e;function t(o,b,w){let E=Math.max(0,Math.min(1,(w-o)/(b-o)));return E*E*(3-2*E)}l.smoothstep=t;function i(o){return o}l.linear=i;function n(o){return o*o}l.easeInQuad=n;function r(o){return o*(2-o)}l.easeOutQuad=r;function f(o){return o<.5?2*o*o:-1+(4-2*o)*o}l.easeInOutQuad=f;function h(o){return o*o*o}l.easeInCubic=h;function u(o){return--o*o*o+1}l.easeOutCubic=u;function s(o){return o<.5?4*o*o*o:(o-1)*(2*o-2)*(2*o-2)+1}l.easeInOutCubic=s;function a(o){return o*o*o*o}l.easeInQuart=a;function c(o){return 1- --o*o*o*o}l.easeOutQuart=c;function p(o){return o<.5?8*o*o*o*o:1-8*--o*o*o*o}l.easeInOutQuart=p;function v(o){return o*o*o*o*o}l.easeInQuint=v;function g(o){return 1+--o*o*o*o*o}l.easeOutQuint=g;function y(o){return o<.5?16*o*o*o*o*o:1+16*--o*o*o*o*o}l.easeInOutQuint=y;function A(o,b,w,E){for(var N=new Array(S.BEZIER_EASING_CACHE_SIZE),T=0;T<S.BEZIER_EASING_CACHE_SIZE;++T)N[T]=S.calcBezier({p0:o.x,p1:b.x,p2:w.x,p3:E.x},T/(S.BEZIER_EASING_CACHE_SIZE-1));return O=>O<=o.x?o.y:E.x<=O?E.y:S.calcBezier({p0:o.y,p1:b.y,p2:w.y,p3:E.y},S.getBezierTfromX({p0:o.x,p1:b.x,p2:w.x,p3:E.x},O,N))}l.bezier=A;function K(o,b,w,E){return A({x:0,y:0},{x:o,y:b},{x:w,y:E},{x:1,y:1})}l.cubicBezier=K})(m.Easings||(m.Easings={})),m.Lerps=void 0,(l=>{function e(h,u,s){return h+(u-h)*s}l.number=e;function t(h,u,s){if(h.length==u.length){let a=[];for(let c=0;c<h.length;c++)a.push(h[c]+(u[c]-h[c])*s);return a}else return console.log("Different length Arrays!!!"),!1}l.numberArray=t;function i(h,u,s){return h.clone().lerp(u,s)}l.THREEVectors=i;function n(h,u,s){return h.clone().slerp(u,s)}l.THREEQuaternion=n;function r(h,u,s){let a=h.clone(),c=u.clone();return a.x=a.x+(c.x-a.x)*s,a.y=a.y+(c.y-a.y)*s,a.z=a.z+(c.z-a.z)*s,a}l.THREEEuler=r;function f(h){if(typeof h=="number")return l.number;if(h instanceof Array)return l.numberArray;if("isVector2"in h||"isVector3"in h||"isVector4"in h||"isColor"in h)return l.THREEVectors;if("isQuaternion"in h)return l.THREEQuaternion;if("isEuler"in h)return l.THREEEuler}l.getLerpFunc=f})(m.Lerps||(m.Lerps={}));class B extends d.EventDispatcher{constructor(){super(),this.isAnimating=!1,this.animatingCount=0,this.dispatchEvents=[],this.variables={},this.dataBase={}}add(e){let t={time:-1,value:this.getValueClone(e.initValue),startValue:this.getValueClone(e.initValue),goalValue:this.getValueClone(e.initValue),easing:e.easing||m.Easings.sigmoid(),lerpFunc:e.customLerpFunc||m.Lerps.getLerpFunc(e.initValue),userData:e.userData};return this.dataBase[e.name]=t.value,this.variables[e.name]=t,this.dispatchEvent({type:"added",varName:e.name,variable:t}),t}setEasing(e,t){let i=this.variables[e];i?i.easing=t:console.warn('"'+e+'" is not exist')}setValue(e,t){let i=this.dataBase[e];if(i!==void 0)typeof i=="number"?this.dataBase[e]=t:"copy"in i?i.copy(t):i instanceof Array&&(i=t.concat()),this.updateDataBase(e),this.cancelAnimate(e);else return console.warn('"'+e+'" is not exist'),null}animate(e,t,i=1,n,r){let f=this.variables[e];return new Promise(u=>{if(f){if(i<=0){this.setValue(e,t),f.time=1,f.onAnimationFinished=()=>{n&&n(),u(null)};return}f.time==-1&&(this.isAnimating=!0,this.animatingCount++),f.time=0,f.duration=i,f.startValue=this.getValueClone(f.value),f.goalValue=this.getValueClone(t),f.onAnimationFinished=()=>{n&&n(),u(null)},r&&this.setEasing(e,r)}else console.warn('"'+e+'" is not exist')})}cancelAnimate(e){let t=this.variables[e];t?(t.time=1,t.onAnimationFinished=null):console.warn('"'+e+'" is not exist')}get(e){return this.variables[e]?this.variables[e].value:(console.warn('"'+e+'" is not exist'),null)}getVariableObject(e,t=!1){return this.variables[e]?this.variables[e]:(t||console.warn('"'+e+'" is not exist'),null)}applyToUniforms(e){let t=Object.keys(this.variables);for(let i=0;i<t.length;i++){let n=this.getVariableObject(t[i]);n&&(e[t[i]]=n)}}isAnimatingVariable(e,t=!1){return this.variables[e]?this.variables[e].time!=-1:(t||console.warn('"'+e+'" is not exist'),null)}getValueClone(e){return typeof e=="number"?e:"clone"in e?e.clone():e instanceof Array?e.concat():e}wait(e){return new Promise(i=>{setTimeout(()=>{i()},e*1e3)})}update(e){this.animatingCount==0&&(this.isAnimating=!1);let t=Object.keys(this.variables);for(let i=0;i<t.length;i++){let n=t[i],r=this.variables[n],f=r.time;if(f==1&&(this.animatingCount--,f=-1,r.onAnimationFinished&&this.dispatchEvents.push(r.onAnimationFinished)),f>=0&&f<1){let h=r.duration,u=r.easing,s=r.lerpFunc;h&&(f+=(e||.016)/h,(h==0||f>=1)&&(f=1));let a=r.goalValue;f<1&&s&&(a=s(r.startValue,r.goalValue,u(f)));let c=this.dataBase[n];typeof c=="number"||!("copy"in c)?this.dataBase[n]=a:"copy"in c&&c.copy(a),this.dispatchEvent({type:"update/"+t[i],deltaTime:e,value:r.value})}r.time=f}for(;this.dispatchEvents.length!=0;){let i=this.dispatchEvents.pop();i&&i()}this.updateDataBase(),this.dispatchEvent({type:"update",deltaTime:e}),this.isAnimating&&this.dispatchEvent({type:"animate",deltaTime:e})}updateDataBase(e){if(e){let i=this.variables[e],n=this.dataBase[e];i&&n!==void 0&&(typeof i.value=="number"||!("copy"in i.value))&&(i.value=n);return}let t=Object.keys(this.dataBase);for(let i=0;i<t.length;i++){let n=this.variables[t[i]],r=this.dataBase[t[i]];n&&r!==void 0&&(typeof n.value=="number"||!("copy"in n.value))&&(n.value=r)}}}var M=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},R={exports:{}};/*!
 * EventEmitter v5.2.9 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - https://oli.me.uk/
 * @preserve
 */(function(l){(function(e){function t(){}var i=t.prototype,n=e.EventEmitter;function r(u,s){for(var a=u.length;a--;)if(u[a].listener===s)return a;return-1}function f(u){return function(){return this[u].apply(this,arguments)}}i.getListeners=function(s){var a=this._getEvents(),c,p;if(s instanceof RegExp){c={};for(p in a)a.hasOwnProperty(p)&&s.test(p)&&(c[p]=a[p])}else c=a[s]||(a[s]=[]);return c},i.flattenListeners=function(s){var a=[],c;for(c=0;c<s.length;c+=1)a.push(s[c].listener);return a},i.getListenersAsObject=function(s){var a=this.getListeners(s),c;return a instanceof Array&&(c={},c[s]=a),c||a};function h(u){return typeof u=="function"||u instanceof RegExp?!0:u&&typeof u=="object"?h(u.listener):!1}i.addListener=function(s,a){if(!h(a))throw new TypeError("listener must be a function");var c=this.getListenersAsObject(s),p=typeof a=="object",v;for(v in c)c.hasOwnProperty(v)&&r(c[v],a)===-1&&c[v].push(p?a:{listener:a,once:!1});return this},i.on=f("addListener"),i.addOnceListener=function(s,a){return this.addListener(s,{listener:a,once:!0})},i.once=f("addOnceListener"),i.defineEvent=function(s){return this.getListeners(s),this},i.defineEvents=function(s){for(var a=0;a<s.length;a+=1)this.defineEvent(s[a]);return this},i.removeListener=function(s,a){var c=this.getListenersAsObject(s),p,v;for(v in c)c.hasOwnProperty(v)&&(p=r(c[v],a),p!==-1&&c[v].splice(p,1));return this},i.off=f("removeListener"),i.addListeners=function(s,a){return this.manipulateListeners(!1,s,a)},i.removeListeners=function(s,a){return this.manipulateListeners(!0,s,a)},i.manipulateListeners=function(s,a,c){var p,v,g=s?this.removeListener:this.addListener,y=s?this.removeListeners:this.addListeners;if(typeof a=="object"&&!(a instanceof RegExp))for(p in a)a.hasOwnProperty(p)&&(v=a[p])&&(typeof v=="function"?g.call(this,p,v):y.call(this,p,v));else for(p=c.length;p--;)g.call(this,a,c[p]);return this},i.removeEvent=function(s){var a=typeof s,c=this._getEvents(),p;if(a==="string")delete c[s];else if(s instanceof RegExp)for(p in c)c.hasOwnProperty(p)&&s.test(p)&&delete c[p];else delete this._events;return this},i.removeAllListeners=f("removeEvent"),i.emitEvent=function(s,a){var c=this.getListenersAsObject(s),p,v,g,y,A;for(y in c)if(c.hasOwnProperty(y))for(p=c[y].slice(0),g=0;g<p.length;g++)v=p[g],v.once===!0&&this.removeListener(s,v.listener),A=v.listener.apply(this,a||[]),A===this._getOnceReturnValue()&&this.removeListener(s,v.listener);return this},i.trigger=f("emitEvent"),i.emit=function(s){var a=Array.prototype.slice.call(arguments,1);return this.emitEvent(s,a)},i.setOnceReturnValue=function(s){return this._onceReturnValue=s,this},i._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},i._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return e.EventEmitter=n,t},l.exports?l.exports=t:e.EventEmitter=t})(typeof window<"u"?window:M||{})})(R);const x=R.exports;class V extends x{constructor(e){super(),this.curves={},this.name=e||"",this.uniforms={},this.frame={start:0,end:0,duration:0}}addFcurveGroup(e,t){this.curves[e]=t,this.calcFrame()}removeFCurve(e){delete this.curves[e],this.calcFrame()}calcFrame(){let e=Object.keys(this.curves),t=1/0,i=-1/0;for(let n=0;n<e.length;n++){let r=this.curves[e[n]];r.frameStart<t&&(t=r.frameStart),r.frameEnd>i&&(i=r.frameEnd)}(t==-1/0||i==1/0)&&(t=0,i=1),this.frame.start=t,this.frame.end=i,this.frame.duration=this.frame.end-this.frame.start}getFCurveGroup(e){return this.curves[e]||null}assignUniforms(e,t){this.uniforms[e]=t}getUniforms(e){if(this.uniforms[e])return this.uniforms[e];let t=this.getFCurveGroup(e);if(t){let i={value:t.createInitValue()};return this.uniforms[e]=i,i}return null}getValue(e,t){let i=this.getUniforms(e);if(!i)return t||null;let n=i.value;return t?typeof n=="number"?(t.x=n,t):(t.x=n.x,t.y=n.y,"z"in t&&"z"in n&&(t.z=n.z),"w"in t&&"w"in n&&(t.w=n.w),t||null):n}getValueAt(e,t,i){let n=this.getFCurveGroup(e);return i?n?n.getValue(t||0,i):i:n?n.getValue(t):null}updateFrame(e){let t=Object.keys(this.curves);for(let i=0;i<t.length;i++){let n=this.curves[t[i]],r=this.getUniforms(t[i]);!r||(typeof r.value=="number"?r.value=n.getValue(e)||0:n.getValue(e,r.value))}this.emitEvent("update",[this])}}class F extends x{constructor(e){super(),this.keyframes=[],this.cache={frame:NaN,value:NaN},this.frameStart=0,this.frameEnd=0,this.frameDuration=0,this.set(e)}set(e){e&&(this.keyframes.length=0,e.forEach(t=>{this.addKeyFrame(t)}))}addKeyFrame(e){let t=0;for(let i=0;i<this.keyframes.length&&this.keyframes[i].coordinate.x<e.coordinate.x;i++)t++;this.keyframes.splice(t,0,e),this.frameStart=this.keyframes[0].coordinate.x,this.frameEnd=this.keyframes[this.keyframes.length-1].coordinate.x}getValue(e){if(e==this.cache.frame)return this.cache.value;let t=null;for(let i=0;i<this.keyframes.length;i++){let n=this.keyframes[i];if(e<=n.coordinate.x){let r=this.keyframes[i-1];r?t=r.to(n,e):t=n.coordinate.y;break}}return t===null&&this.keyframes.length>0&&(t=this.keyframes[this.keyframes.length-1].coordinate.y),t!==null?(this.cache={frame:e,value:t},t):0}}class I extends x{constructor(e,t,i,n,r,f){super(),this.type="scalar",this.name=e||"",this.frameStart=0,this.frameEnd=0,this.frameDuration=0,this.curve={x:null,y:null,z:null,w:null,scalar:null},t&&this.setFCurve(t,"x"),i&&this.setFCurve(i,"y"),n&&this.setFCurve(n,"z"),r&&this.setFCurve(r,"w")}setFCurve(e,t){this.curve[t]=e,this.calcType(),this.calcFrame()}calcType(){this.curve.scalar&&(this.type="scalar"),this.curve.w?this.type="vec4":this.curve.z?this.type="vec3":this.curve.y?this.type="vec2":this.curve.x&&(this.type="scalar")}calcFrame(){let e=Object.keys(this.curve),t=1/0,i=-1/0;for(let n=0;n<e.length;n++){let r=this.curve[e[n]];!r||(r.frameStart<t&&(t=r.frameStart),r.frameEnd>i&&(i=r.frameEnd))}(t==-1/0||i==1/0)&&(t=0,i=1),this.frameStart=t,this.frameEnd=i,this.frameDuration=this.frameEnd-this.frameStart}createInitValue(){return this.type=="vec2"?new d.Vector2:this.type=="vec3"?new d.Vector3:this.type=="vec4"?new d.Vector4:0}getValue(e,t){return t?(this.curve.x&&(t.x=this.curve.x.getValue(e)),this.curve.y&&(t.y=this.curve.y.getValue(e)),this.curve.z&&"z"in t&&(t.z=this.curve.z.getValue(e)),this.curve.w&&"w"in t&&(t.w=this.curve.w.getValue(e)),t):this.curve.scalar?this.curve.scalar.getValue(e):null}}class z extends x{constructor(e,t,i,n){super(),this.coordinate={x:0,y:0},this.handleLeft={x:0,y:0},this.handleRight={x:0,y:0},this.interpolation="BEZIER",this.easing=null,this.nextFrame=null,this.set(e,t,i,n)}set(e,t,i,n){this.coordinate=e,this.handleLeft=t||e,this.handleRight=i||e,this.interpolation=n||"BEZIER"}getEasing(e,t){return e=="BEZIER"?m.Easings.bezier(this.coordinate,this.handleRight,t.handleLeft,t.coordinate):i=>{let n=t.coordinate.y-this.coordinate.y;return i=(i-this.coordinate.x)/(t.coordinate.x-this.coordinate.x),this.coordinate.y+i*n}}to(e,t){return(this.nextFrame==null||this.nextFrame.coordinate.x!=e.coordinate.x||this.nextFrame.coordinate.y!=e.coordinate.y)&&(this.easing=this.getEasing(this.interpolation,e),this.nextFrame=e),this.easing?this.easing(t):0}}class j extends x{constructor(e){super(),this.connected=!1,this.frameCurrent=0,this.frameStart=0,this.frameEnd=0,this.objects=[],this.actions=[],e&&(this.url=e,this.connect(this.url))}connect(e){this.url=e,this.ws=new WebSocket(this.url),this.ws.onopen=this.onOpen.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onclose=this.onClose.bind(this),this.ws.onerror=t=>{console.error(t)}}syncJsonScene(e){let t=new XMLHttpRequest;t.onreadystatechange=()=>{t.readyState==4&&t.status==200&&this.onSyncScene(JSON.parse(t.response))},t.open("GET",e),t.send()}onSyncScene(e){this.actions.length=0,this.objects.length=0,e.actions.forEach(t=>{let i=new V(t.name),n=Object.keys(t.fcurve_groups);for(let r=0;r<n.length;r++){let f=n[r],h=new I(f);t.fcurve_groups[f].forEach(u=>{let s=new F;s.set(u.keyframes.map(a=>new z(a.c,a.h_l,a.h_r,a.i))),h.setFCurve(s,u.axis)}),i.addFcurveGroup(h.name,h)}this.actions.push(i)}),e.objects.forEach(t=>{this.objects.push(t)}),this.emitEvent("update/scene",[this]),this.setTimeline(this.frameCurrent)}onSyncTimeline(e){this.setTimeline(e.current,e.start,e.end)}onOpen(e){this.connected=!0}onMessage(e){let t=JSON.parse(e.data);t.type=="sync/scene"?this.onSyncScene(t.data):t.type=="sync/timeline"&&this.onSyncTimeline(t.data)}onClose(e){this.disposeWS()}getActionNameList(e){for(let t=0;t<this.objects.length;t++)if(this.objects[t].name==e)return this.objects[t].actions;return[]}getAction(e){for(let t=0;t<this.actions.length;t++)if(this.actions[t].name==e)return this.actions[t];return null}getActionList(e){let t=[];return this.getActionNameList(e).forEach(n=>{let r=this.getAction(n);r&&t.push(r)}),t}getActionContainsAccessor(e){return this.actions.find(t=>Object.keys(t.curves).some(n=>n==e))||null}setTimeline(e,t,i){this.frameCurrent=e,this.frameStart=t||this.frameStart,this.frameEnd=i||this.frameEnd,this.emitEvent("update/timeline",[this.frameCurrent,this.frameStart,this.frameEnd])}dispose(){this.disposeWS()}disposeWS(){this.ws&&(this.ws.close(),this.ws.onmessage=null,this.ws.onclose=null,this.ws.onopen=null,this.connected=!1)}}const D=`#define GLSLIFY 1
varying vec2 vUv;void main(){gl_Position=vec4(position,1.0);vUv=uv;}`,G=`#define GLSLIFY 1
uniform sampler2D tex;varying vec2 vUv;void main(){gl_FragColor=texture2D(tex,vUv);}`;m.UniformsLib=void 0,(l=>{function e(...t){let i={};for(let n=0;n<t.length;n++)t[n]!=null&&Object.assign(i,t[n]);return i}l.mergeUniforms=e})(m.UniformsLib||(m.UniformsLib={}));class W{constructor(e,t){this.renderTargets=[],this.renderer=e,this.dataSize=t.clone(),this.uniforms={dataSize:{value:this.dataSize}},this.tempDataLinear=this.createData({minFilter:d.LinearFilter,magFilter:d.LinearFilter}),this.tempDataNear=this.createData({minFilter:d.NearestFilter,magFilter:d.NearestFilter}),this.scene=new d.Scene,this.camera=new d.Camera,this.materials=[],this.mesh=new d.Mesh(new d.PlaneBufferGeometry(2,2)),this.scene.add(this.mesh)}get isSupported(){return this.renderer.extensions.get("OES_texture_float")}createInitializeTexture(){let e=new Float32Array(this.uniforms.dataSize.value.x*this.uniforms.dataSize.value.y*4),t=new d.DataTexture(e,this.uniforms.dataSize.value.x,this.uniforms.dataSize.value.y,d.RGBAFormat,d.FloatType);return t.needsUpdate=!0,t}createData(e,t){let i=navigator.userAgent,n=i.indexOf("iPhone")>=0||i.indexOf("iPad")>=0||navigator.platform=="iPad"||navigator.platform=="MacIntel"&&navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1&&navigator.standalone!==void 0,r={wrapS:d.ClampToEdgeWrapping,wrapT:d.ClampToEdgeWrapping,minFilter:d.NearestFilter,magFilter:d.NearestFilter,format:d.RGBAFormat,type:n?d.HalfFloatType:d.FloatType,stencilBuffer:!1,depthBuffer:!1},f=null,h=null;e&&(e.isDataTexture?(f=e,t&&(h=t)):h=e),h&&(r.wrapS=h.wrapS||r.wrapS,r.wrapT=h.wrapT||r.wrapT,r.minFilter=h.minFilter||r.minFilter,r.magFilter=h.magFilter||r.magFilter,r.format=h.format||r.format,r.type=h.type||r.type,r.stencilBuffer=h.stencilBuffer||r.stencilBuffer,r.depthBuffer=h.depthBuffer||r.depthBuffer);let u=new d.WebGLRenderTarget(this.uniforms.dataSize.value.x,this.uniforms.dataSize.value.y,r),s={buffer:u};if(this.renderTargets.push(u),f){let a=this.createKernel({fragmentShader:G,uniforms:{tex:{value:f}}});this.compute(a,s)}return s}createKernel(e){let t=m.UniformsLib.mergeUniforms(e.uniforms,this.uniforms);e.uniforms=t,e.vertexShader=e.vertexShader||D;let i=new d.ShaderMaterial(e);return this.materials.push(i),{material:i,uniforms:e.uniforms}}compute(e,t,i){let n;t.buffer.texture.magFilter==d.LinearFilter?n=this.tempDataLinear:n=this.tempDataNear,this.mesh.material=e.material;let r=this.renderer.getRenderTarget();this.renderer.setRenderTarget(n.buffer),this.renderer.render(this.scene,i||this.camera),this.swapBuffers(t,n),this.renderer.setRenderTarget(r)}swapBuffers(e,t){let i=e.buffer;e.buffer=t.buffer,t.buffer=i}dispose(){this.mesh.geometry.dispose();for(let t=0;t<this.materials.length;t++)this.materials[t].dispose();this.scene.remove(this.mesh),this.tempDataLinear.buffer.dispose(),this.tempDataNear.buffer.dispose()}resizeData(e){this.dataSize.copy(e);for(let t=0;t<this.renderTargets.length;t++)this.renderTargets[t].setSize(e.x,e.y)}}const U=`#define GLSLIFY 1
varying vec2 vUv;void main(){vUv=uv;gl_Position=vec4(position,1.0);}`;class H{constructor(e,t,i){this.renderer=e,this.scene=new d.Scene,this.camera=new d.OrthographicCamera(-1,1,1,-1),this.screen=new d.Mesh(i||new d.PlaneBufferGeometry(2,2)),this.scene.add(this.screen),t.vertexShader=t.vertexShader||U,t.uniforms=t.uniforms||{},t.uniforms.resolution={value:new d.Vector2},this.effect={material:new d.ShaderMaterial(t)}}render(e,t=null){let i=this.renderer.getRenderTarget(),n=this.effect,r=n.material,f=r.uniforms;if(e){let h=Object.keys(e);for(let u=0;u<h.length;u++)f[h[u]]?f[h[u]].value=e[h[u]]:(f[h[u]]={value:e[h[u]]},n.material.needsUpdate=!0,n.material.uniforms=f)}t?f.resolution.value.set(t.width,t.height):this.renderer.getSize(f.resolution.value),this.screen.material=r,this.renderer.setRenderTarget(t),this.renderer.render(this.scene,this.camera),this.renderer.setRenderTarget(i)}}class Q{constructor(e,t,i){this.obj=e,this.baseTransform={position:this.obj.position.clone(),rotation:this.obj.quaternion.clone(),scale:this.obj.scale.clone()},this.transform=t,i||(this.transform.position&&this.transform.position.add(this.obj.position),this.transform.rotation&&this.transform.rotation.multiply(this.obj.quaternion))}updateTransform(e){this.transform.position&&this.obj.position.copy(this.baseTransform.position.clone().lerp(this.transform.position,e)),this.transform.rotation&&this.obj.quaternion.copy(this.baseTransform.rotation.clone().slerp(this.transform.rotation,e)),this.transform.scale&&this.obj.scale.copy(this.baseTransform.scale.clone().multiplyScalar(this.transform.scale*e+1-e))}}class Z extends d.EventDispatcher{constructor(){super()}goHome(){this.dispatchEvent({type:"gohome"})}wait(e){return new Promise((t,i)=>{const n=()=>{i(),this.removeEventListener("gohome",n)};this.addEventListener("gohome",n),setTimeout(()=>{this.removeEventListener("gohome",n),t()},e*1e3)})}}m.AnimationAction=V,m.Animator=B,m.BaseLayer=P,m.BlenderConnector=j,m.Controller=k,m.FCurve=F,m.FCurveGroup=I,m.FCurveKeyFrame=z,m.GPUComputationController=W,m.LayoutController=Q,m.Pointer=C,m.PostProcessing=H,m.WaitMan=Z,Object.defineProperties(m,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
